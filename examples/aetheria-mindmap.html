<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aetheria – Mindmap (Mermaid)</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #11182d;
      --text: #e6e8ef;
      --muted: #93a1c1;
      --accent: #7aa2f7;
      --btn: #1b2340;
      --btn-hover: #243059;
      --ok: #3ecf8e;
      --warn: #f4bf75;
    }
    [data-theme="light"] {
      --bg: #f7f8fc;
      --panel: #ffffff;
      --text: #0b1020;
      --muted: #4b5563;
      --accent: #1d4ed8;
      --btn: #e5e7eb;
      --btn-hover: #d1d5db;
      --ok: #059669;
      --warn: #b45309;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 12px;
    }
    header, footer {
      padding: 12px 16px;
      background: var(--panel);
      box-shadow: 0 1px 0 rgba(255,255,255,0.04) inset;
    }
    header h1 { margin: 0; font-size: 18px; font-weight: 600; letter-spacing: 0.2px; }
    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-top: 8px; }
    button, select {
      background: var(--btn);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover { background: var(--btn-hover); }
    button.primary { border-color: var(--accent); }
    button.ok { border-color: var(--ok); }
    button.warn { border-color: var(--warn); }
    .layout { display: grid; grid-template-columns: 380px 1fr; gap: 12px; padding: 0 12px 12px; }
    .panel {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      display: flex; flex-direction: column; min-height: 0;
    }
    .panel h2 { margin: 12px; font-size: 14px; font-weight: 600; color: var(--muted); }
    textarea {
      width: 100%; flex: 1; resize: none; background: transparent; color: var(--text);
      border: 0; outline: none; padding: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px; line-height: 1.4; tab-size: 2; white-space: pre;
    }
    .diagram-wrap { position: relative; overflow: auto; flex: 1; }
    .diagram-inner { padding: 12px; min-height: 100%; }
    .hint { margin: 8px 12px 12px; color: var(--muted); font-size: 12px; }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; padding: 12px; border-top: 1px solid rgba(255,255,255,0.06); }
    .grow { flex: 1; }
    .kbd { padding: 1px 6px; border: 1px solid rgba(255,255,255,0.15); border-bottom-width: 2px; border-radius: 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; color: var(--muted); }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; background: rgba(122,162,247,0.15); border: 1px solid rgba(122,162,247,0.45); color: var(--accent); font-size: 12px; margin-left: 8px; }
    footer { font-size: 12px; color: var(--muted); }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body data-theme="dark">
  <header>
    <h1>Aetheria – Mindmap<span class="badge">static&nbsp;HTML</span></h1>
    <div class="toolbar">
      <button id="btn-render" class="primary">Render (⌘/Ctrl+Enter)</button>
      <button id="btn-copy">Copy Mermaid</button>
      <button id="btn-download-svg" class="ok">Download SVG</button>
      <button id="btn-download-png" class="ok">Download PNG</button>
      <select id="theme">
        <option value="dark" selected>Dark</option>
        <option value="neutral">Neutral</option>
        <option value="forest">Forest</option>
        <option value="base">Base</option>
        <option value="light">Light (UI)</option>
      </select>
      <span class="grow"></span>
      <button id="btn-fit">Fit to Width</button>
      <button id="btn-reset">Original Size</button>
      <button id="btn-toggle-ui">UI Theme: Dark</button>
    </div>
  </header>

  <main class="layout">
    <section class="panel">
      <h2>Mermaid Source</h2>
      <textarea id="source" spellcheck="false">mindmap
  root((Aetheria – die Welt))
    Figuren
      Kaelen Veyra (Flammendes Herz)
        Herkunft: Celestine – verbannt
        Trauma: Tod seiner Geliebten Lirien
        Macht: Soulfire – Flamme aus Liebe &amp; Grief
        Beziehungen
          zu Sylra: „Du warst mein Gedächtnis.“
          zu Morvath: „Du hast mich verbrannt – aber auch gerettet.“
          zu Elyra: Sie flüstert, wenn er nicht hört.
      Sylra D’Tharn (Schatten der Seele)
        Herkunft: Nyxara – geflohen
        Trauma: Mutter als Waffe, Meister getötet
        Macht: Emotionweave – Liebe als Kraft
        Beziehungen
          zu Kaelen: „Du warst nicht in meinem Traum. Du warst mein Gedächtnis.“
          zu Morvath: „Ich kenne deine Mutter. Sie hat mich geliebt.“
          zu Elyra: „Du bist die Einzige, die mich nicht als Waffe sah.“
      Morvath (Ungeheuer des Griefs)
        Herkunft: Nyxara – verbannt
        Trauma: Verrat, Familie getötet, Schwester verloren
        Macht: Grief Crown – Schmerz als Kraft
        Beziehungen
          zu Kaelen: „Du warst ein Dichter – ich bin nur noch eine Stimme im Dunkel.“
          zu Sylra: „Deine Mutter liebte mich – und verließ mich.“
          zu Elyra: „Du lachtest, als ich weinte – mein erstes Licht.“
      Elyra – Die Vergessene (die fließende Erinnerung)
        Natur: Keine Herkunft – ist die Welt
        Zustand: Nicht tot, nicht lebendig – das, was vergessen wurde
        Macht: Erinnerung als Gegenmacht
        Beziehungen
          zu Kaelen: „Du bist nicht verloren, weil du liebst.“
          zu Sylra: „Liebe ist keine Waffe – sie ist eine Einladung.“
          zu Morvath: „Dann hat sie dich geliebt, als du noch lachen konntest.“
          zu allen: „Ihr wart nur vergessen.“

    Reiche &amp; Orte
      Celestine – Helle Welt
        Symbol: Flammen werden zu Licht
        Kaelen war hier – verbannt, weil „die Flamme der Liebe nicht rein“ sei
        Beziehung zu Elyra: Sie war hier – aber wir sahen sie nicht
      Nyxara – Dunkle Welt
        Symbol: Schatten, die fließen wie Tränen
        Morvath wurde hier König durch Trauer
        Sylra stammte hier – floh, weil Liebe „eine Waffe“ ist
        Beziehung zu Elyra: Sie war hier – aber wir nannten sie nicht
      Veyra – Tal der Gesichter
        Symbol: 30 verlorene Masken – jede ein Mensch
        Kaelen sieht seine Liebe – nicht tot, nur vergessen
        Sylra sieht ihr altes Ich – Waffe, die liebte, um zu töten
        Elyra erscheint – „Schlange aus Licht“
        Sinnbild: „Liebe ist nicht die Flamme – sie ist der Boden, auf dem sie brennt.“
      Thal’Vor – Land der Sprachlosen
        Symbol: Ein Vogel aus Stille
        Sylra lernt: Schmerz ist nicht Macht – aber kann lieben
        Kaelen sieht eine unerlöschliche Flamme – Symbol für Elyra
        Beziehung zu Elyra: „Sie flüsterte – aber wir hörten sie.“
      Vale of Whispers – Tal der Geflüsterten Namen
        Symbol: Vogel der Erinnerung mit einem Namen im Schnabel
        Kaelen ruft „Lirien“ – Antwort als Schatten
        Sylra ruft „Mutter“ – die Luft zittert, doch nicht ihre Mutter
        Elyra flüstert: „Ihr wart nur vergessen.“
        Beziehung zu Morvath: „Du warst hier – aber du hörtest nicht.“

    Kosmologie
      Natur: Erinnerungsbasierte Schale aus dem ersten Weltall
      In ihr lebt alles – auch die Toten, wenn man sie hört
      Nach Elyras letzter Botschaft: „Die Welt atmet neu.“
      Macht der Welt: Sie erinnert sich an alle Liebe

    Verbindungen (ohne Kanten, semantisch)
      Kaelen ↔ Sylra: „Flamme und Schatten verbinden sich, wenn einer lacht.“
      Morvath ↔ Elyra: „Er weinte, sie lachte – sein erstes Licht.“
      Elyra ↔ Alle: „Ihr wart nur vergessen.“ (Refrain)
      Celestine ↔ Nyxara: „Zwei Seiten einer Wunde – beide lieben.“
      Veyra ↔ Vale: „Hier wird die Liebe geboren – und hier stirbt sie.“
      Thal’Vor ↔ Veyra: „Sprache der Liebe verloren – und wiedergefunden.“

    Letzte Botschaft
      Elyra: „Ihr wart nur vergessen.“
      Aetheria: „Nein. Wir waren nur verloren – bis du uns riefst.“</textarea>
      <div class="row">
        <span class="hint">Tipp: <span class="kbd">⌘/Ctrl</span> + <span class="kbd">Enter</span> rendert neu.</span>
      </div>
    </section>

    <section class="panel diagram">
      <h2>Diagram</h2>
      <div class="diagram-wrap">
        <div class="diagram-inner" id="diagram"></div>
      </div>
      <div class="row">
        <span class="hint">Scroll/Zoom via Browser (⌘/Ctrl + Mausrad). „Fit to Width“ setzt <code>width:100%</code> auf die SVG.</span>
      </div>
    </section>
  </main>

  <footer>
    Mermaid läuft lokal im Browser über CDN. Für Offline-Nutzung ersetzen Sie die Script-URLs durch lokale Dateien.
  </footer>

  <!-- Mermaid via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    const uiState = { mermaidTheme: 'dark', uiTheme: 'dark', fitted: false };
    function initMermaid(theme) {
      mermaid.initialize({
        startOnLoad: false,
        theme: theme === 'base' ? 'base' : (['dark','neutral','forest'].includes(theme) ? theme : 'neutral'),
        securityLevel: 'loose',
        fontFamily: 'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, Liberation Sans, sans-serif',
        mindmap: { padding: 12 }
      });
    }
    function currentSvgEl(){ return document.querySelector('#diagram svg'); }
    async function renderDiagram(){
      const src = document.getElementById('source').value;
      const { svg } = await mermaid.render('aetheria_mindmap', src);
      document.getElementById('diagram').innerHTML = svg;
      if (uiState.fitted) fitToWidth();
    }
    function fitToWidth(){
      const svg = currentSvgEl(); if(!svg) return;
      svg.style.width='100%'; svg.removeAttribute('height'); uiState.fitted=true;
    }
    function resetSize(){
      const svg = currentSvgEl(); if(!svg) return;
      svg.style.width='';
      if(!svg.getAttribute('height')){
        const vb = svg.getAttribute('viewBox'); if(vb){
          const p = vb.split(' ').map(parseFloat);
          if(p.length===4){ const h=p[3]||800; svg.setAttribute('height', String(Math.round(h))); }
        }
      }
      uiState.fitted=false;
    }
    function copySource(){
      const src = document.getElementById('source').value;
      navigator.clipboard.writeText(src).then(()=>flash('Mermaid-Code kopiert.'));
    }
    function flash(msg){
      const el=document.createElement('div');
      el.textContent=msg;
      el.style.position='fixed'; el.style.bottom='16px'; el.style.right='16px';
      el.style.background='rgba(0,0,0,0.75)'; el.style.color='white';
      el.style.padding='10px 12px'; el.style.borderRadius='10px'; el.style.zIndex='9999';
      document.body.appendChild(el); setTimeout(()=>el.remove(), 1600);
    }
    function svgString(){
      const svg=currentSvgEl(); if(!svg) return null;
      const clone=svg.cloneNode(true);
      if(!clone.style.background){
        const bg=getComputedStyle(document.body).getPropertyValue('--panel')||'#ffffff';
        clone.style.background=bg.trim();
      }
      const serializer=new XMLSerializer();
      const raw=serializer.serializeToString(clone);
      return '<?xml version="1.0" encoding="UTF-8"?>\\n'+raw;
    }
    function downloadBlob(content, mime, filename){
      const blob=new Blob([content],{type:mime});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download=filename;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }
    function downloadSVG(){
      const s=svgString(); if(!s) return;
      downloadBlob(s,'image/svg+xml;charset=utf-8','aetheria-mindmap.svg');
    }
    function svgToPng(svgText, scale=2.5){
      return new Promise((resolve,reject)=>{
        const img=new Image();
        const svgBlob=new Blob([svgText],{type:'image/svg+xml;charset=utf-8'});
        const url=URL.createObjectURL(svgBlob);
        img.onload=()=>{
          const w=img.naturalWidth||1600, h=img.naturalHeight||900;
          const canvas=document.createElement('canvas');
          canvas.width=Math.round(w*scale); canvas.height=Math.round(h*scale);
          const ctx=canvas.getContext('2d');
          const bg=getComputedStyle(document.body).getPropertyValue('--panel')||'#ffffff';
          ctx.fillStyle=bg.trim(); ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.drawImage(img,0,0,canvas.width,canvas.height);
          canvas.toBlob((blob)=>{ URL.revokeObjectURL(url); if(!blob) reject(new Error('PNG encode failed')); else resolve(blob); },'image/png');
        };
        img.onerror=(e)=>{ URL.revokeObjectURL(url); reject(e); };
        img.src=url;
      });
    }
    async function downloadPNG(){
      const s=svgString(); if(!s) return;
      const blob=await svgToPng(s,2.5);
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='aetheria-mindmap.png';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }
    function setUiTheme(mode){
      document.body.setAttribute('data-theme', mode==='light' ? 'light' : 'dark');
      document.getElementById('btn-toggle-ui').textContent = `UI Theme: ${mode==='light' ? 'Light' : 'Dark'}`;
    }
    window.addEventListener('DOMContentLoaded',()=>{
      initMermaid('dark'); renderDiagram();
      document.getElementById('btn-render').addEventListener('click', renderDiagram);
      document.getElementById('btn-copy').addEventListener('click', copySource);
      document.getElementById('btn-download-svg').addEventListener('click', downloadSVG);
      document.getElementById('btn-download-png').addEventListener('click', downloadPNG);
      document.getElementById('btn-fit').addEventListener('click', fitToWidth);
      document.getElementById('btn-reset').addEventListener('click', resetSize);
      document.getElementById('theme').addEventListener('change',(e)=>{
        const t=e.target.value; uiState.mermaidTheme=t;
        initMermaid(t==='light' ? 'neutral' : t); renderDiagram();
      });
      document.getElementById('btn-toggle-ui').addEventListener('click',()=>{
        uiState.uiTheme = uiState.uiTheme==='dark' ? 'light' : 'dark';
        setUiTheme(uiState.uiTheme);
      });
      window.addEventListener('keydown',(e)=>{
        if((e.metaKey||e.ctrlKey)&&e.key==='Enter'){ e.preventDefault(); renderDiagram(); }
      });
    });
  </script>
</body>
</html>